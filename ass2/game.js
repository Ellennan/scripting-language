function convert(e){return 0===e?"":Number(e)?'<img src="treasure.jpg" width="45" height="45" style="vertical-align:middle">':"h"===e?'<img src="hero.jpg" width="45" height="45" style="vertical-align:middle">':"o"===e?'<img src="obstacle.jpg" width="45" height="45" style="vertical-align:middle">':"k"===e?'<img src="killer.jpg" width="45" height="45" style="vertical-align:middle">':void 0}function clearMessage(){m1=document.getElementById("m1"),m1.style.display="none"}function showMessage(e,r){m1=document.getElementById("m1"),m1.innerHTML=e,m1.style.display="block",m1.className=r}function validateInput(e){return clearMessage(),console.log(e),null===e?-1:"h"===e?0===numOfHero?1:(alert("Only 1 hero is allowed"),0):e.match(/^[1-9ok]$/)?1:(alert("Invalid input"),0)}function setup(e,r,o){if(0===stage)if(clearMessage(),console.log("x = "+e+" y = "+r),console.log("b = "+board[r][e]),0!==board[r][e])showMessage("Grid position ["+e+","+r+"] already occupied","RedBG");else{do var n=prompt("Type number(1-9), letter o, h or k");while(0===validateInput(n));Number(n)?(board[r][e]=parseInt(n),numOfTreasure+=1,document.getElementById("treasure").innerHTML=numOfTreasure):"o"===n?board[r][e]="o":"h"===n?(board[r][e]="h",numOfHero=1,heroX=e,heroY=r):"k"===n&&(board[r][e]="k",numOfKiller+=1,killerPosition.push([e,r])),null!==n&&(o=o||window.event,o.target.innerHTML=convert(n))}}function init(e){for(y=0;y<board.length;y++){var r=document.createElement("tr");for(e.appendChild(r),x=0;x<board[y].length;x++){var o=document.createElement("td"),n=document.createTextNode(convert(board[y][x]));o.appendChild(n),o.addEventListener?o.addEventListener("click",setup.bind(null,x,y),!1):o.attachEvent("onclick",setup.bind(null,x,y)),r.appendChild(o)}}}function endSetup(){if(0===numOfHero)alert("No hero!");else{if(stage=1,document.getElementById("h3").innerHTML="Play stage",play=document.getElementById("play"),play.style.display="none",end=document.getElementById("end"),end.style.display="block",end.style="margin:0 auto",0===numOfTreasure)return void endGame();heroX-1>=0&&"o"!==board[heroY][heroX-1]?movableHero=!0:10>heroX+1&&"o"!==board[heroY][heroX+1]?movableHero=!0:heroY-1>=0&&"o"!==board[heroY-1][heroX]?movableHero=!0:10>heroY+1&&"o"!==board[heroY+1][heroX]&&(movableHero=!0),document.onkeydown=processKey}}function processKey(e){if(1===stage)switch(clearMessage(),e=e||window.event,e.keyCode){case 65:console.log("left"),move("left");break;case 68:console.log("right"),move("right");break;case 87:console.log("up"),move("up");break;case 83:console.log("down"),move("down");break;default:showMessage("Invalid typing","RedBG")}}function moveHero(e){switch(e){case"left":heroX-1>=0?"o"===board[heroY][heroX-1]?showMessage("Occupied by an obstacle","RedBG"):"k"===board[heroY][heroX-1]?die():(board[heroY][heroX-1]>0&&(numOfTreasure-=1,heroScore+=board[heroY][heroX-1]),board[heroY][heroX]=0,board[heroY][heroX-1]="h",table.rows[heroY].cells[heroX].innerHTML=convert(0),table.rows[heroY].cells[heroX-1].innerHTML=convert("h"),heroX-=1):showMessage("Outside the grid","RedBG");break;case"right":10>heroX+1?"o"===board[heroY][heroX+1]?showMessage("Occupied by an obstacle","RedBG"):"k"===board[heroY][heroX+1]?die():(board[heroY][heroX+1]>0&&(numOfTreasure-=1,heroScore+=board[heroY][heroX+1]),board[heroY][heroX]=0,board[heroY][heroX+1]="h",table.rows[heroY].cells[heroX].innerHTML=convert(0),table.rows[heroY].cells[heroX+1].innerHTML=convert("h"),heroX+=1):showMessage("Outside the grid","RedBG");break;case"up":heroY-1>=0?"o"===board[heroY-1][heroX]?showMessage("Occupied by an obstacle","RedBG"):"k"===board[heroY-1][heroX]?die():(board[heroY-1][heroX]>0&&(numOfTreasure-=1,heroScore+=board[heroY-1][heroX]),board[heroY][heroX]=0,board[heroY-1][heroX]="h",table.rows[heroY].cells[heroX].innerHTML=convert(0),table.rows[heroY-1].cells[heroX].innerHTML=convert("h"),heroY-=1):showMessage("Outside the grid","RedBG");break;case"down":10>heroY+1?"o"===board[heroY+1][heroX]?showMessage("Occupied by an obstacle","RedBG"):"k"===board[heroY+1][heroX]?die():(board[heroY+1][heroX]>0&&(numOfTreasure-=1,heroScore+=board[heroY+1][heroX]),board[heroY][heroX]=0,board[heroY+1][heroX]="h",table.rows[heroY].cells[heroX].innerHTML=convert(0),table.rows[heroY+1].cells[heroX].innerHTML=convert("h"),heroY+=1):showMessage("Outside the grid","RedBG")}}function moveRobots(){for(var e=0,r=0;numOfKiller>r;r++){var o=killerPosition[r][0],n=killerPosition[r][1],l=heroX-o,t=heroY-n;if(Math.abs(l)<=1&&Math.abs(t)<=1)return void die();if(n-1>=0){if(board[n-1][o]>0){numOfTreasure-=1,killerScore+=board[n-1][o],board[n][o]=0,board[n-1][o]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n-1].cells[o].innerHTML=convert("k"),killerPosition[r]=[o,n-1];continue}if(o-1>=0&&board[n-1][o-1]>0){numOfTreasure-=1,killerScore+=board[n-1][o-1],board[n][o]=0,board[n-1][o-1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n-1].cells[o-1].innerHTML=convert("k"),killerPosition[r]=[o-1,n-1];continue}if(10>o+1&&board[n-1][o+1]>0){numOfTreasure-=1,killerScore+=board[n-1][o+1],board[n][o]=0,board[n-1][o+1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n-1].cells[o+1].innerHTML=convert("k"),killerPosition[r]=[o+1,n-1];continue}}if(o-1>=0&&board[n][o-1]>0)numOfTreasure-=1,killerScore+=board[n][o-1],board[n][o]=0,board[n][o-1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n].cells[o-1].innerHTML=convert("k"),killerPosition[r]=[o-1,n];else if(10>o+1&&board[n][o+1]>0)numOfTreasure-=1,killerScore+=board[n][o+1],board[n][o]=0,board[n][o+1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n].cells[o+1].innerHTML=convert("k"),killerPosition[r]=[o+1,n];else{if(10>n+1){if(board[n+1][o]>0){numOfTreasure-=1,killerScore+=board[n+1][o],board[n][o]=0,board[n+1][o]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n+1].cells[o].innerHTML=convert("k"),killerPosition[r]=[o,n+1];continue}if(o-1>=0&&board[n+1][o-1]>0){numOfTreasure-=1,killerScore+=board[n+1][o-1],board[n][o]=0,board[n+1][o-1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n+1].cells[o-1].innerHTML=convert("k"),killerPosition[r]=[o-1,n+1];continue}if(10>o+1&&board[n+1][o+1]>0){numOfTreasure-=1,killerScore+=board[n+1][o+1],board[n][o]=0,board[n+1][o+1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n+1].cells[o+1].innerHTML=convert("k"),killerPosition[r]=[o+1,n+1];continue}}if(l=Math.sign(l),t=Math.sign(t),0!==board[n+t][o+l]){if(n-1>=0){if(0===board[n-1][o]){board[n][o]=0,board[n-1][o]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n-1].cells[o].innerHTML=convert("k"),killerPosition[r]=[o,n-1];continue}if(o-1>=0&&0===board[n-1][o-1]){board[n][o]=0,board[n-1][o-1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n-1].cells[o-1].innerHTML=convert("k"),killerPosition[r]=[o-1,n-1];continue}if(10>o+1&&0===board[n-1][o+1]){board[n][o]=0,board[n-1][o+1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n-1].cells[o+1].innerHTML=convert("k"),killerPosition[r]=[o+1,n-1];continue}}if(o-1>=0&&0===board[n][o-1])board[n][o]=0,board[n][o-1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n].cells[o-1].innerHTML=convert("k"),killerPosition[r]=[o-1,n];else if(10>o+1&&0===board[n][o+1])board[n][o]=0,board[n][o+1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n].cells[o+1].innerHTML=convert("k"),killerPosition[r]=[o+1,n];else{if(10>n+1){if(0===board[n+1][o]){board[n][o]=0,board[n+1][o]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n+1].cells[o].innerHTML=convert("k"),killerPosition[r]=[o,n+1];continue}if(o-1>=0&&0===board[n+1][o-1]){board[n][o]=0,board[n+1][o-1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n+1].cells[o-1].innerHTML=convert("k"),killerPosition[r]=[o-1,n+1];continue}if(10>o+1&&0===board[n+1][o+1]){board[n][o]=0,board[n+1][o+1]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n+1].cells[o+1].innerHTML=convert("k"),killerPosition[r]=[o+1,n+1];continue}}e+=1}}else board[n][o]=0,board[n+t][o+l]="k",table.rows[n].cells[o].innerHTML=convert(0),table.rows[n+t].cells[o+l].innerHTML=convert("k"),killerPosition[r]=[o+l,n+t]}}e===numOfKiller&&(movableRobot=!1)}function move(e){return moveHero(e),moveRobots(),document.getElementById("treasure").innerHTML=numOfTreasure,document.getElementById("userscore").innerHTML=heroScore,document.getElementById("computerscore").innerHTML=killerScore,0===numOfTreasure||movableHero===!1&&movableRobot===!1?void endGame():(round+=1,void(document.getElementById("round").innerHTML=round))}function die(){stage=2,document.getElementById("h3").innerHTML="End stage",end=document.getElementById("end"),end.style.display="none",showMessage("You Died!<br>Game Over, You Lose!","font")}function endGame(){stage=2,document.getElementById("h3").innerHTML="End stage",end=document.getElementById("end"),end.style.display="none",heroScore>killerScore?showMessage("Game Over, You Win!","font"):killerScore>heroScore?showMessage("Game Over, You Lose!","font"):showMessage("Game Over, Draw!","font")}for(var board=new Array,i=0;10>i;i++){board[i]=new Array;for(var j=0;10>j;j++)board[i][j]=0}var stage=0,numOfHero=0,heroX,heroY,numOfKiller=0,killerPosition=new Array,round=1,numOfTreasure=0,heroScore=0,killerScore=0,movableHero=!1,movableRobot=!0;table=document.getElementById("t1"),init(table);